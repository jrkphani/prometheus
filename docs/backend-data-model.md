# Prometheus App - Backend Data Model

## Phase 1: Core MVP Features - Backend Data Model & API

### Proposal Data Model

We've implemented the core data model for "Proposals" using Amplify Gen 2. This creates the necessary DynamoDB table structure and a GraphQL API (powered by AWS AppSync) for the frontend to interact with proposal data.

#### Schema Definition

The Proposal model includes the following fields:

- `id` (auto-generated by Amplify)
- `owner` (string, required) - Links the proposal to its creator
- `customProposalId` (string, required) - Our custom ID format: 1CH_CUSTO_ProjectName_DD-mmm-YY
- `projectName` (string, required)
- `customerName` (string, required)
- `status` (string, required) - Possible values: 'DRAFT', 'SUBMITTED', 'IN_REVIEW', 'WON', 'LOST', 'ARCHIVED'
- `createdAt` (auto-generated by Amplify)
- `updatedAt` (auto-generated by Amplify)

#### Authorization Rules

The authorization rules for the Proposal model are:

1. **Owner-based Access Control**:
   - The creator of a proposal has full CRUD (Create, Read, Update, Delete) permissions on their own proposals.
   - The `owner` field is automatically populated with the Cognito username of the creator.

2. **Authenticated User Access**:
   - Any authenticated user can create new proposals.
   - Any authenticated user can read proposals (this will be refined later for "Shared with Me" functionality).

3. **Future Enhancements**:
   - Admin access rules will be added later for administrative functions.
   - More granular sharing permissions will be implemented for team collaboration.

#### Custom Proposal ID Generation

We've implemented a Lambda function (`proposalIdGenerator.ts`) to generate custom proposal IDs following the format:
`1CH_CUSTO_ProjectName_DD-mmm-YY`

- First 5 characters of the customer name (padded if needed), uppercase
- First 10 characters of the project name with spaces replaced by underscores, uppercase
- Current date in DD-MMM-YY format

### Implementation Details

1. **Data Definition**: `amplify/data/resource.ts`
   - Defines the Proposal model schema
   - Sets up authorization rules
   - Registers the custom Lambda function

2. **Lambda Function**: `amplify/custom-logic/proposalIdGenerator.ts`
   - Generates custom proposal IDs based on project name, customer name, and current date
   - Called during proposal creation process

3. **Authentication**: Integrated with existing Cognito User Pool
   - Email-based authentication
   - User attributes include email, familyName, and givenName

### Next Steps

1. **Deploy the Backend**:
   ```bash
   amplify push
   ```
   This will provision the DynamoDB table, AppSync API, and Lambda function.

2. **Test the API**:
   - Use the Amplify-generated GraphQL API (AppSync) console to test operations.
   - Verify that authorization rules work as expected.

3. **Frontend Integration**:
   - Generate the API client in the frontend
   - Implement proposal creation and listing functionality

4. **Model Extensions for Future Phases**:
   - Add models for ProposalSection, Comment, TeamMember
   - Implement more granular sharing and permissions
   - Add versioning support for proposals 